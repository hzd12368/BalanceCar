# 平衡小车

------



## 概况

​	本工程用于平衡小车的下位机，是控制下位机主控芯片STM32F103c8t6的代码。代码基于ST的`STM32Cube FW_F1 V1.6.0`固件库，开发工具为`Keil uVision5`。

## 主要组成及其功能

​	实现一种二轮的平衡小车，完成小车的直立、差速转弯和蓝牙控制。同时搭配oled显示用户界面，实现用户显示的交互。

## 原理图和PCB板图

- 原理图

  

- PCB板图

  

## 实物图接口



## 引脚说明

- 主控芯片

主控芯片使用STM32F103c8t6，拥有48个引脚，其引脚定义如下：

| 引脚号 | 芯片定义 |  程序定义  | 引脚号 | 芯片定义 |  程序定义  | 引脚号 | 芯片定义 |  程序定义  |
| :----: | :------: | :--------: | :----: | :------: | :--------: | :----: | :------: | :--------: |
|   1    |   VBAT   |    3.3V    |   17   |   PA7    | SPI1_MOSI  |   33   |   PA12   |   CAN_TX   |
|   2    |   PC13   |   SysLED   |   18   |   PB0    | MotorA_IN1 |   34   |   PA13   |   SWDIO    |
|   3    |   PC14   |            |   19   |   PB1    | MotorA_IN2 |   35   |  VSS_2   |   信号地   |
|   4    |   PC15   |            |   20   |   PB2    |            |   36   |  VDD_2   |   电源地   |
|   5    |   PD0    |   OSC_IN   |   21   |   PB10   | MotorB_IN1 |   37   |   PA14   |   SWCLK    |
|   6    |   PD1    |  OSC_OUT   |   22   |   PB11   | MotorB_IN2 |   38   |   PA15   |    预留    |
|   7    |   NRST   |    RST     |   23   |  VSS_1   |   信号地   |   39   |   PB3    |    预留    |
|   8    |   VSSA   |    VSSA    |   24   |  VDD_1   |   电源地   |   40   |   PB4    | MotorB_ENA |
|   9    |   VDDA   |    VDDA    |   25   |   PB12   |            |   41   |   PB5    | MotorB_ENB |
|   10   |   PA0    | MotorA_ENA |   26   |   PB13   |            |   42   |   PB6    | USART1_TX  |
|   11   |   PA1    | MotorA_ENB |   27   |   PB14   |            |   43   |   PB7    | USART1_RX  |
|   12   |   PA2    | DrivePower |   28   |   PB15   |            |   44   |  BOOT0   |   信号地   |
|   13   |   PA3    |            |   29   |   PA8    |    PWMA    |   45   |   PB8    |  I2C1_SCL  |
|   14   |   PA4    |            |   30   |   PA9    |    PWMB    |   46   |   PB9    |  I2C1_SDA  |
|   15   |   PA5    |  SPI1_SCK  |   31   |   PA10   |            |   47   |  VSS_3   |   信号地   |
|   16   |   PA6    |  SPI_MISO  |   32   |   PA11   |   CAN_RX   |   48   |  VDD_3   |   电源地   |

## 上下位机控制协议

1. **下传协议格式：
   起始位（1个字节）+数据的符号位（1个字节）+数据位（2个字节）+功能标志位（1个字节）+校验位（1个字节）+结束位（1个字节）**

   *校验位 = （对象的标志位 + 数据位1 + 数据位2 + 功能标志位 ） & 0x7F*

   

   测试代码：

   1. 软件复位--上位机测试(EE 00 E0 E0 7F 3F FF)
   2. 旋转电机运行设置--上位机测试,设置旋转电机停止(EE 01 00 00 10 11 FF)；设置旋转电机顺时针60速度运行(EE 01 01 3C 10 4E FF)；设置旋转电机逆时针60速度运行(EE 01 02 3C 10 4F FF)

## 代码文件构成

## 

## 具体功能实现情况

- 直立电机
  - [x] 电机正反转
  - [x] 电机的速度PID
  - [ ] 电机的状态监测
  - [ ] 电机的位置控制
- 系统设置
  - [ ] 暂无

## 注意事项

在下位机初步安装阶段，可以使调试工具调试各部分功能是否正常。
[调试工具点我下载](/uploads/609cf1a2a52ff086e30ef0dfcf1ccdb8/调试工具.zip)
